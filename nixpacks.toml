# Nixpacks configuration for CyberShakti Railway deployment
# This configures the build environment with Node.js 20 and Python 3.11

[phases.setup]
# Install Node.js 20, Python 3.11, and pip
nixPkgs = ["nodejs_20", "python311", "python311Packages.pip"]

# Add system libraries required by opencv-python
nixLibs = ["libGL", "glib"]

[phases.install]
# Install Node.js and Python dependencies
cmds = [
  "pnpm install",
  "pip install -r python/requirements.txt"
]

[phases.build]
# Build frontend and backend
cmds = [
  "pnpm run build:client",
  "pnpm run build:server"
]

[start]
# Start the Node.js server (which will spawn Python services)
cmd = "node dist/server/node-build.mjs"
